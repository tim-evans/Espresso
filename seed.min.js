/**
 * Seed
 * ====
 *  A small JavaScript Library used to grow your own JavaScript libraries.
 *
 * Contributors
 *   Tim Evans <tim.evans@junctionnetworks.com>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
var mix=function(){var a=arguments;return{into:function(g){var m,n,d,f=0,h=a?a.length:0,e=0,b,c,l,k;for(;f<h;f+=1){d=a[f];for(m in d){n=d[m];c=n&&n.aliases||[];c.push(m);for(e=0;e<c.length;e+=1){b=c[e];if(g[b]&&n.isInferior){continue}l=n&&n._;if(Function.isFunction(n)){for(k in l){if(l.hasOwnProperty(k)){n=l[k](g,n,b)}}}g[b]=n;if(b==="toString"&&g.toString===Object.prototype.toString){g.toString=n}else{if(b==="valueOf"&&g.valueOf===Object.prototype.valueOf){g.valueOf=n}}}if(n&&n.aliases){delete n.aliases}}}return g}}};Function.isFunction=function(a){return a instanceof Function};mix({echo:function(a){return a}}).into(Function);mix({inferior:function(){this.isInferior=true;return this}}).into(Function.prototype);mix({alias:function(){this.aliases=Array.from(arguments);return this},around:function(){this._=this._||{};this._.around=function(b,d,a){var c=b[a]||Function.empty;if(!c){return d}return function(){return d.apply(this,[c.bind(this)].concat(Array.from(arguments)))}};return this},on:function(){this._=this._||{};var a=Array.from(arguments);this._.pubsub=function(f,h,e){var d=0,b=a.length,j,g,c;if(f.subscribe&&f.publish){for(d=0;d<b;d+=1){j=a[d];if(j.indexOf(".")!==-1){c=j.lastIndexOf(".");g=j.slice(c+1);j=j.slice(0,c);_G.getObjectFor(j).subscribe(g,h.bind(f))}else{f.subscribe(a[d],h.bind(f))}}}return h};return this},property:function(){this.isProperty=true;return this}.inferior()}).into(Function.prototype);mix({bind:function(a){var b=this;return function(){return b.apply(a,arguments)}},curry:function(){var b=Array.prototype.slice,a=b.apply(arguments),c=this;return function(){return c.apply(this,a.concat(b.apply(arguments)))}}.inferior(),delay:function(c){var b=Array.from(arguments).slice(1),a=this;setTimeout(function(){return a.apply(a,b)},c)},defer:function(){var a=Array.from(arguments);a.unshift(0);return this.delay.apply(this,a)}}).into(Function.prototype);Enumerable={map:function(c,b){var a=[];c=c||Function.echo;this.forEach(function(){a.push(c.apply(b,arguments))});return a}.inferior(),reduce:function(d,b){var a=(typeof b==="undefined"),c=this;this.forEach(function(f,e){if(a){b=f;a=false}else{b=d(b,f,e,c)}});return b}.inferior(),toArray:function(){return this.map()},size:function(){return this.reduce(function(a){return a+1},0)},filter:function(b,a){return this.reduce(function(e,d,c,f){if(b.apply(a,[d,c,f])){e.push(d)}},[])}.inferior(),every:function(b,a){return this.reduce(function(f,d,c,e){return f&&b.apply(a,[d,c,e])},true)}.inferior(),some:function(b,a){return this.reduce(function(f,d,c,e){return f||b(a,[d,c,e])},false)}.inferior(),pluck:function(a){return this.map(function(b){if(b.get){return b.get(a)}else{return b[a]}})},extract:function(c){var a=[],b=this;if(!(c instanceof Array)){c=[c]}c.forEach(function(e,d){if(b.get){a.push(b.get(d))}else{a.push(b[d])}});return a},contains:function(c){var a=this,b=Array.from(arguments);if(b.length>1){return b.every(function(e,d){return a.contains(e)})}else{return this.reduce(function(f,e,d){return f||e===c},false)}},zip:function(){var a=Function.echo,b=Array.from(arguments),c;if(Function.isFunction(b.slice(-1)[0])){a=b.pop()}c=[this].concat(b).map(Array.from);return this.map(function(e,d){return a(c.pluck(d))})}};PubSub={_subscriptions:null,subscribe:function(b,a){var c=this._subscriptions||{};if(!c[b]){c[b]=[]}c[b].push(a);this._subscriptions=c;return this},unsubscribe:function(b,a){var c=this._subscriptions;if(c&&c[b]){c[b].remove(a)}return this},publish:function(b){var c=this._subscriptions,a=Array.from(arguments);if(c&&c[b]){c[b].forEach(function(d){d.defer.apply(d,a)}.bind(this))}return this}};mix({from:(function(){var a=Array.prototype.slice;return function(b){return a.apply(b)}}())}).into(Array);mix(Enumerable,{forEach:function(d,b){var c=0,a=this.length;for(;c<a;c+=1){d.apply(b,[this[c],c,this])}}.inferior(),indexOf:function(d,c){var b=0,a=this.length;c=c||0;b=c>=0?c:b.max(a-Math.abs(c));for(;b<a;b+=1){if(d in this&&d===this[b]){return b}}return -1}.inferior(),lastIndexOf:function(d,c){var b=0,a=this.length;c=c||a;b=c>=0?a.min(c+1):a-Math.abs(c)+1;while(b--){if(d in this&&d===this[b]){return b}}return -1}.inferior(),unique:function(){var a={};this.forEach(function(c,b){a[c]=c});return a.values()}.inferior(),without:function(){var a=Array.from(arguments);return this.reduce(function(c,b){if(a.indexOf(b)===-1){c.push(b)}return c},[])},json:function(){var a=[];this.forEach(function(b){a.push(b.json())});return"[{}]".fmt(a.join(","))}}).into(Array.prototype);Seed=mix(PubSub,{init:function(){},extend:function(){var a=function(){},b;a.prototype=this;b=new a();mix.apply(null,arguments).into(b);if(b.init&&Function.isFunction(b.init)){b.init()}return b},get:function(c){var d,a=c.lastIndexOf("."),b;if(a===-1){b=this}else{b=_G.getObjectFor(c.slice(0,a),this);c=c.slice(a+1)}if(b){d=b[c];if(typeof d==="undefined"){d=b.unknownProperty.apply(b,arguments)}else{if(d&&d.isProperty){d=d.apply(b,[c])}}return d}return undefined},set:function(c,e){var d,a=c.lastIndexOf("."),b;if(a===-1){b=this}else{b=_G.getObjectFor(c.slice(0,a),this);c=c.slice(a+1)}if(b){d=b[c];if(b.publish){b.publish(c,e)}if(d&&d.isProperty){d.apply(b,[c,e])}else{if(typeof d==="undefined"){b.unknownProperty.apply(b,arguments)}else{b[c]=e}}}return this},unknownProperty:function(a,b){if(typeof b!=="undefined"){this[a]=b}return b}.property(),json:function(){var b,c,a=[];for(b in this){c=this[b];if(b.charAt(0)!=="_"){if(!Function.isFunction(c)){a.push("{}:{}".fmt(b.json(),c.json()))}}}return"{{{}}}".fmt(a.join(","))}}).into({});mix(Enumerable,{forEach:function(c,b){var d=0,a=this.length;for(;d<a;d+=1){c.apply(b,[this.charAt(d),d,this])}}.inferior(),capitalize:function(){return this.charAt(0).toUpperCase()+this.slice(1)},camelize:(function(){var a=/([\2-+_\s]+)(.)/g;return function(){return this.replace(a,function(d,b,c){return c.toUpperCase()})}}()),dasherize:(function(){var a=/([a-z])([A-Z])/g,b=/([_+\s]+)/g;return function(){var c=this.replace(a,function(f,e,d){return e+"-"+d.toLowerCase()});return c.toLowerCase().replace(b,"-")}}()),times:function(a){return(new Array(a+1)).join(this)},trim:function(){return this.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}.inferior(),unescape:(function(){var a={quot:'"',lt:"<",gt:">",amp:"&"},b=/&([^&;]+);/g;return function(){return this.replace(b,function(d,c){var e=a[c];return typeof e==="string"?e:d})}}()),escape:(function(){var b={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot"},a=/[<>&"]/g;return function(){return this.replace(a,function(d){return b[d]})}}()),contains:function(a){return this.indexOf(a)!==-1},fmt:function(){var a=Array.from(arguments);a.unshift(this.toString());return Formatter.fmt.apply(Formatter,a)},__fmt__:function(b){var c=b.match(Formatter.SPECIFIER),h=c[1],f=c[2]||" ",d=c[6]||0,a,e,g;if(h){h=h.slice(-1)}a=Math.max(d,this.length);e=a-this.length;g=0;switch(h){case">":g=e;e=0;break;case"^":g=Math.ceil(e/2);e=Math.floor(e/2);break}return f.times(e)+this+f.times(g)},json:function(){return'"'+this+'"'}}).into(String.prototype);Formatter={SPECIFIER:/((.)?[><=\^])?([ +\-])?([#])?(0?)(\d+)?(.\d+)?([bcoxXeEfFG%ngd])?/,fmt:function(g){var e=Array.from(arguments).slice(1),h="",d="",c,b,a=g.length,f;for(b=0;b<a;b+=1){f=g[b];if(h==="}"){if(f!=="}"){throw new Error("Unmatched closing brace.")}else{d+="}";h="";continue}}if(f==="{"){c=this.parseField(g.slice(b+1),e);d+=c[1];b+=c[0]}else{if(f!=="}"){d+=f}}h=f}return d},parseField:function(g,e){var d="",c=null,b=0,f,a=g.length;for(;b<a;b+=1){f=g[b];if(f==="{"){if(d.length===0){return[1,"{"]}c=this.parseField(g.slice(b+1),e);if(!c[0]){return[b,"{"]}else{b+=c[0];d+=c[1]}}else{if(f==="}"){return[b+1,this.formatField(d,e)]}else{d+=f}}}return[g.length,d]},formatField:function(d,c){var b=d.indexOf(":"),a;b=b===-1?d.length:b;a=d.slice(b+1);d=d.slice(0,b);if(d!==""){d=_G.getObjectFor(d,c)}else{d=c.shift()}if(!a){return d}return d?d.__fmt__(a):d}};mix({json:function(){return isFinite(this)?String(this):"null"},__fmt__:function(h){if(!isFinite(this)){return this}var c=h.match(Formatter.SPECIFIER),e=c[1],i=c[2],b=c[3]||"-",a=!!c[4],d=c[7],f=c[8],g=this;if(e){e=e.slice(-1)}if(!i&&!!c[5]){i="0";h="0"+h;if(!e){e="=";h=h[0]+"="+h.slice(1)}}if(d){d=d.slice(1)}switch(b){case"+":b=(g>=0)?"+":"-";break;case"-":b=(g>=0)?"":"-";break;case" ":b=(g>=0)?" ":"-";break;default:b=""}if(d){g=+g.toFixed(d)}g=Math.abs(g);switch(f){case"b":a=a?"0b":"";g=a+g.toString(2);break;case"c":g=String.fromCharCode(g);break;case"o":a=a?"0o":"";g=a+g.toString(8);break;case"x":a=a?"0x":"";g=a+g.toString(16).toLowerCase();break;case"X":a=a?"0x":"";g=a+g.toString(16).toUpperCase();break;case"e":g=g.toExponential().toLowerCase();break;case"E":g=g.toExponential().toUpperCase();break;case"f":g=g.toFixed().toLowerCase();break;case"F":g=g.toFixed().toUpperCase();break;case"G":g=String(g).toUpperCase();break;case"%":g=(g.toFixed()*100)+"%";break;case"n":g=g.toLocaleString();break;case"g":case"d":case undefined:g=String(g).toLowerCase();break;default:throw new Error('Unrecognized format type: "{0}"'.fmt(h.type))}if(e!=="="){g=b+g}g=String(g).__fmt__(h);if(e==="="){g=b+g}return g}}).into(Number.prototype);_G=mix({getObjectFor:(function(){var a=function(b,c){if(b in c){c=c[b]}else{if(c instanceof Array&&c.length===1){c=c[0]}if(b in c){c=c[b]}else{c=undefined}}return c};return function(e,c){var d=e.indexOf("["),b=e.indexOf(".");c=(arguments.length===1)?_G:c;if(!isDefined(c)){return c}if((d<b||b===-1)&&d>-1){if(e[0]!=="["){c=a(e.split("[",1),c)}e=e.slice(e.indexOf("[")+1);c=a(e.split("]",1),c);e=e.slice(e.indexOf("]")+1);if(!(e===""||e[0]==="."||e[0]==="[")){throw new Error("You need to properly index elements!")}if(e.length&&e[0]==="."){e=e.slice(1)}return getObjectFor(e,c)}else{if((b<d||d===-1)&&b>-1){c=a(e.split(".",1),c);e=e.slice(e.indexOf(".")+1);return getObjectFor(e,c)}else{if(e===""){return c}}}return a(e,c)}}()),isDefined:function(a){return(typeof a!=="undefined"&&a!==null)}}).into(this);mix({get:function(a){return this["get"+a.capitalize()]()},toLocaleTimeString:function(){return"{:H:M:S}".fmt(this)}.inferior(),toISOString:function(){return"{:Y-m-dTH:M:S.f}Z".fmt(new Date(this.get("time")+this.get("timezoneOffset")*60*1000))}.inferior(),json:function(){return'"{0}"'.fmt(this.toISOString())},__fmt__:(function(){var b=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],a=["January","February","March","April","May","June","July","August","September","October","November","December"];return function(e){var c="",d=0;for(;d<e.length;d+=1){switch(e[d]){case"a":c+=b[this.get("day")].slice(0,3);break;case"A":c+=b[this.get("day")];break;case"b":c+=a[this.get("month")].slice(0,3);break;case"B":c+=a[this.get("month")];break;case"c":c+="{:A, B H:M:S Y}".fmt(this);break;case"d":c+="{:02}".fmt(this.get("date"));break;case"f":c+="{:03}".fmt(this.get("milliseconds"));break;case"H":c+="{:02}".fmt(this.get("hours"));break;case"I":c+="{:02}".fmt(this.get("hours")%12);break;case"j":c+="{:03}".fmt(Math.ciel(this-new Date(this.get("fullYear"),0,1)/86400000));break;case"m":c+="{:02}".fmt(this.get("month")+1);break;case"M":c+="{:02}".fmt(this.get("minutes"));break;case"p":c+=this.get("hours")>11?"PM":"AM";break;case"S":c+="{:02}".fmt(this.get("seconds"));break;case"w":c+=this.get("day");break;case"x":c+="{:m/d/y}".fmt(this);break;case"X":c+=this.toLocaleTimeString();break;case"y":c+="{:02}".fmt(this.getYear()%100);break;case"Y":c+=this.get("fullYear");break;case"Z":c+=this.get("timezoneOffset");break;default:c+=e[d]}}return c}}())}).into(Date.prototype);mix({json:function(){var b,c,a=[];for(b in this){c=this[b];if(this.hasOwnProperty(b)){if(!Function.isFunction(c)){a.push("{}:{}".fmt(b.json(),c.json()))}}}return"{{{}}}".fmt(a.join(","))}.inferior(),__fmt__:function(a){String(this).__fmt__(a)}.inferior()}).into(Object.prototype);mix({json:function(){return String(this)}}).into(Boolean.prototype);Hash=Seed.extend(Enumerable,{forEach:function(d,c){var b,a;for(b in this){a=this.get(b);if(b[0]!=="_"&&!Function.isFunction(a)){d.apply(c,[a,b,this])}}},keys:function(){return this.map(function(b,a){return b})},values:function(){return this.map(function(b,a){return a})},toArray:function(){return this.map(function(b,a){return[b,a]})}});